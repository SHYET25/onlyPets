<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="icon" href="media/images/utilities/paw.png" type="image/png" />

    <!-- BS LINKS -->
    <!-- <link rel="stylesheet" href="../../bsCSS/bootstrap.css">
    <link rel="stylesheet" href="../../bsCSS/bootstrap.min.css"> -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Font Awesome Link -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />

    <!-- Page CSS and JS -->
    <link rel="stylesheet" href="../../cssFile/coachingCSS.css" />

    <style>
      *::-webkit-scrollbar {
        width: 8px;
      }
      *::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      *::-webkit-scrollbar-thumb {
        background-color: #cccccc;
        border-radius: 10px;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: #38b6ff;
        margin: 0;
        padding: 0;
        font-family: helvetica, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Navbar Styles */
      .navbar {
        background-color: transparent;
        color: white;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        padding: 1rem 0.3rem;
      }

      .navbar .navbar-brand img {
        height: 50px;
        width: 65%;
        margin-left: 30px;
      }

      .navbar .nav-item .nav-link {
        color: white;
        font-size: 16px;
        font-weight: 500;
        transition: color 0.3s;
        margin-right: 10px;
      }

      .navbar .nav-item .nav-link:hover {
        color: #f3f3f3;
      }

      .navbar .form-control {
        border-radius: 20px;
        display: none; /* Initially hidden */
      }

      .navbar .search-icon {
        font-size: 2rem; /* Increased size */
        cursor: pointer;
        color: black;
      }

      .navbar .search-icon:hover {
        color: #f3f3f3;
      }

      .navbar .form-control.show {
        display: block; /* Show input when the icon is clicked */
      }

      /* Add equal margin between icons */
      .navbar .nav-link {
        margin-left: 15px;
      }

      /* Add equal margin between icons except the last child */
      .navbar .d-flex i {
        font-size: 2rem; /* Increase icon size */
        margin-left: 15px; /* Equal margin between icons */
        margin-left: 15px; /* Equal margin between icons */
        cursor: pointer;
        color: black;
        transition: color 0.3s;
      }

      /* Hover effect for icons */
      .navbar .d-flex i:hover {
        color: #f3f3f3;
      }

      /* Chat Dropdown & Message Styles - Match ownerProfile */
      #chatDropdown {
        display: none;
        position: absolute;
        top: 80px;
        right: 100px;
        background: #fff;
        box-shadow: 0 8px 32px rgba(56, 182, 255, 0.15),
          0 1.5px 8px rgba(0, 0, 0, 0.08);
        border-radius: 18px;
        width: 370px;
        max-height: 500px;
        overflow-y: auto;
        padding: 0;
        z-index: 1050;
        border: none;
      }
      .chat-message {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 18px;
        border-bottom: 1px solid #f1f1f1;
        cursor: pointer;
        transition: background 0.2s, box-shadow 0.2s;
        background: transparent;
        position: relative;
      }
      .chat-message:last-child {
        border-bottom: none;
      }
      .chat-message:hover {
        background: #eaf6ff;
        box-shadow: 0 2px 8px rgba(56, 182, 255, 0.08);
      }
      .profile-img {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #38b6ff22;
        background: #f3f3f3;
      }
      .message-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
      }
      .name {
        font-weight: 700;
        color: #1976d2;
        font-size: 1.05rem;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .message {
        color: #555;
        font-size: 0.97rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 180px;
      }
      .time {
        font-size: 0.85rem;
        color: #aaa;
        align-self: flex-end;
        margin-top: 2px;
      }
      #chatDropdown::-webkit-scrollbar {
        width: 6px;
      }
      #chatDropdown::-webkit-scrollbar-thumb {
        background-color: #ddd;
        border-radius: 3px;
      }
      #chatDropdown::-webkit-scrollbar-track {
        background-color: #f1f1f1;
      }

      #bellDropdown {
        display: none;
        position: absolute;
        top: 80px;
        right: 30px;
        background-color: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        width: 400px; /* Adjusted width for better visibility */
        max-height: 400px;
        overflow-y: auto;
        padding: 15px;
        z-index: 1000;
        transition: opacity 0.3s ease;
      }

      .notification-message {
        display: flex;
        margin-bottom: 20px;
        align-items: flex-start;
        padding: 5px;
        border-bottom: 1px solid #f5f5f5;
      }

      .notification-message:last-child {
        border-bottom: none;
      }

      .profile-img {
        width: 45px; /* Adjusted size for better proportion */
        height: 45px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 15px;
      }

      .notification-details {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      .name {
        font-weight: bold;
        font-size: 14px;
        color: #333;
        margin-bottom: 5px;
      }

      .notification {
        font-size: 14px;
        color: #555;
        line-height: 1.4;
        margin-bottom: 5px;
      }

      .time {
        font-size: 12px;
        color: #aaa;
        align-self: flex-end;
      }

      .notification-message:hover {
        background-color: #f9f9f9;
        cursor: pointer;
      }

      #bellDropdown::-webkit-scrollbar {
        width: 6px;
      }

      #bellDropdown::-webkit-scrollbar-thumb {
        background-color: #ddd;
        border-radius: 3px;
      }

      #bellDropdown::-webkit-scrollbar-track {
        background-color: #f1f1f1;
      }

      .text-warning {
        color: #ffc107; /* Yellow color for the 'Haha' reaction */
      }

      /* Sidebar Styling */
      .sidebar {
        height: calc(100% - 100px);
        width: 80px;
        position: fixed;
        top: 54%;
        left: 30px;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.7);
        border-radius: 20px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* Space between top links and bottom icon */
        align-items: center; /* Center items horizontally */
        padding-top: 10px;
        padding-bottom: 10px;
        margin-top: 10px;
      }

      .sidebar a {
        margin-bottom: 10px; /* Adjust spacing between top links */
        text-decoration: none;
        font-size: 2rem;
        color: #333333;
        display: block;
        transition: 0.3s;
      }

      .sidebar a:hover {
        color: #ffff;
      }

      /* Make the icon's background red and circular when active */
      .sidebar .top-links a .active {
        background-color: #38b6ff;
        border-radius: 50%;
        color: #000; /* Change icon color to white */
        padding: 10px; /* Add some padding for the circular effect */
      }

      .sidebar .top-links a i {
        transition: all 0.3s ease; /* Smooth transition for background color and size */
      }

      /* Hover effect for icons */
      .sidebar .top-links a:hover .active {
        background-color: #38b6ff;
        color: white;
      }

      /* Ensure the inactive state doesn't have the circle background */
      .sidebar .top-links a i {
        background: none;
        border-radius: 0;
      }

      .sidebar .top-links a .deactive {
        background-color: transparent;
        border-radius: 50%;
        color: #000; /* Change icon color to white */
        padding: 10px; /* Add some padding for the circular effect */
        font-size: 2rem;
      }

      /* Hover effect for icons */
      .sidebar .top-links a:hover .deactive {
        background-color: transparent;
        color: white;
        font-size: 2rem;
      }

      .sidebar .bottom-icon {
        margin-bottom: 10px; /* Keep space from the bottom of the sidebar */
        color: #333333;
        font-size: 2rem;
        transition: 0.3s;
      }

      .sidebar .bottom-icon:hover {
        color: #ffffff;
      }

      .top-links a {
        /* No margin applied here so the first child stays at the top */
        padding-top: 20px;
      }

      .top-links a:not(:first-child) {
        margin-top: 20px; /* Add margin only to links except the first one */
      }

      /* Main content area */
      #main {
        background-color: #38b6ff;
        background-image: url("media/images/utilities/bgMain.png"); /* Update this line */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 100%;
        overflow-x: hidden;
        padding-top: 10vh;
      }

      .active {
        color: white;
      }

      #imageModal {
        z-index: 10000;
      }

      #loadingScreen {
        display: none; /* Initially hidden */
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        z-index: 10000; /* Ensure it's above other content */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #loadingScreen img {
        width: 300px; /* Adjust size as needed */
        height: 400px; /* Adjust size as needed */
      }

      /* Responsive Table */
      .table-responsive {
        overflow-x: auto;
      }

      .active {
        color: white;
      }

      hr {
        color: gray;
      }

      .contentType {
        margin-left: 0px;
      }

      .contentTypeButtonDeactive {
        margin-left: 100px;
        background-color: transparent;
        border-radius: 25px;
        width: 150px;
        font-weight: 900;
      }

      .contentTypeButtonActive {
        margin-left: 100px;
        background-color: #ffde59;
        border-radius: 25px;
        width: 150px;
        font-weight: 900;
      }

      .contentTypeButtonActive:hover {
        margin-left: 100px;
        background-color: #9c7d00;
        border-radius: 25px;
        width: 150px;
        font-weight: 900;
      }

      #main {
        background-color: #38b6ff;
        background-image: url("media/images/utilities/bgMain.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 100%;
        overflow-x: hidden;
        overflow-y: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .container {
        width: 80%;
        margin-top: 30px;
      }

      .hidden {
        display: none;
      }

      #publicContainer,
      #personalizedContainer {
        height: 100%;
        overflow: hidden;
        scrollbar-gutter: stable; /* Prevent scrollbar shift */
      }

      #personalizedContainer:hover {
        overflow: auto; /* Add scroll if content overflows */
        scrollbar-gutter: stable; /* Prevent scrollbar shift */
      }

      #publicContainer:hover {
        overflow: auto; /* Add scroll if content overflows */
        scrollbar-gutter: stable; /* Prevent scrollbar shift */
      }

      #rightContent {
        height: 100%; /* Match height with the main section */
        overflow-y: auto; /* Add scroll if content overflows */
        padding: 10px;
      }

      #centerContent {
        height: 100%; /* Match height with the main section */
        padding: 0%;
        scrollbar-gutter: stable; /* Prevent scrollbar shift */
        overflow: hidden;
        padding: 10px;
      }

      .mainContent {
        height: 100%;
        margin-top: 0.5%;
        width: 100%;
      }

      #postComposer {
        width: 100%; /* Default width in "public" */
        height: 60px; /* Collapsed height */
        overflow: hidden; /* Hide content when collapsed */
        transition: height 0.6s ease; /* Smooth transition for height */
        border-radius: 15px;
        text-align: center;
        background-color: #85d2ff;
        border-color: #85d2ff;
      }

      #petMateList {
        width: 100%; /* Default width in "public" */
        margin-top: 10px;
        height: 58%; /* Collapsed height */
        overflow: hidden;
        border-radius: 15px;
        text-align: center;
        background-color: #85d2ff;
        border-color: #85d2ff;
      }

      .petMateH5 {
        font-weight: 900;
        background-color: #38b6ff;
        padding: 10px;
        width: 100%;
        border-radius: 10px;
      }

      .petMateH5 h5 {
        font-weight: 900;
        background-color: #38b6ff;
      }

      #postComposer h5 {
        font-weight: 900;
      }

      .petCollection {
        height: 100%;

        scrollbar-gutter: stable;
        overflow: hidden;
      }

      .petCollection:hover {
        overflow: auto;
        scrollbar-gutter: stable; /* Prevent scrollbar shift */
        height: 100%;
      }

      #postComposer:hover {
        height: 40%; /* Expand to a fixed height on hover */
      }

      /* Add this fallback to ensure consistent behavior */
      #postComposer:focus,
      #postComposer:active {
        width: 100%; /* Maintain 100% width if focused or active */
        height: 220px; /* Set height to same as hover to maintain consistency */
      }

      .pet-img,
      .friend-img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
      }

      #petList {
        margin-top: 10px;
      }

      .pet-img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
      }

      .pet-img-profile {
        margin-left: 3px;
        width: 90%;
        height: 90%;
        border-radius: 50%;
        object-fit: cover;
        aspect-ratio: 1 / 1; /* Ensures width and height are always equal */
        display: block;
      }

      .pet-item:hover {
        background-color: #f1f1f1;
        cursor: pointer;
        border-radius: 8px;
        transition: background-color 0.3s ease;
      }

      .pet-item {
        padding: 10px;
      }

      .pet-item img {
        border: 2px solid #007bff;
      }

      .pet-item-profile img {
        border: 4px solid #000;
      }

      .pet-name {
        flex: 1; /* Ensures the name stays on the leftmost side */
        text-align: left; /* Align text to the left */
      }

      .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }

      .post-header .fw-bold {
        font-size: 16px;
      }

      .post-header .text-muted {
        font-size: 14px;
      }

      .post-card {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .post-content {
        font-size: 16px;
        color: #333;
      }

      .post-footer {
        font-size: 14px;
      }

      .tagged-users .tagged-user {
        color: #38bcff;
      }

      .post-time {
        font-size: 12px;
        color: #888;
      }

      .post-actions button {
        border: 1px solid #ddd;
        background-color: #f7f7f7;
        color: #333;
        font-size: 14px;
      }

      .post-actions button:hover {
        background-color: #e1e1e1;
      }

      .post-actions i {
        margin-right: 5px;
      }

      .post-actions button:focus {
        outline: none;
        box-shadow: none;
      }

      .post-actions .btn-light {
        border-radius: 25px;
      }

      .postFas {
        font-size: 1rem;
      }

      .post-content img {
        object-fit: cover; /* Ensures images fill the container without distortion */
        border-radius: 8px; /* Adds rounded corners to images */
        max-width: 100%; /* Ensures image doesn't exceed container width */
        height: auto; /* Maintains aspect ratio */
      }

      .post-actions .btn {
        padding: 6px 12px;
        font-size: 14px;
      }

      #postScope {
        opacity: 0.5;
        font-size: 12px;
        padding: 5px;
      }

      #searchModal .modal-dialog {
        max-width: 900px; /* Custom width between large and fullscreen */
        height: 85vh; /* Custom height */
      }

      #searchInput {
        width: 100% !important; /* Forces full width */
        border-radius: 25px;
        padding: 20px 30px;
        font-size: 18px;
        border: 1px solid #ccc;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .pet-img2 {
        width: 200px; /* Fixed size for profile image */
        height: 200px; /* Ensure the height matches */
        object-fit: cover; /* Prevents stretching of the image */
        border-radius: 50%; /* Makes it circular */
      }

      .media-preview-wrapper {
        position: relative;
        display: inline-block;
      }

      .remove-media-btn {
        position: absolute;
        top: -5px;
        right: -5px;
        border-radius: 50%;
        padding: 0 6px;
        font-size: 16px;
        line-height: 1;
        display: none;
        z-index: 2;
      }

      .media-preview-wrapper:hover .remove-media-btn {
        display: block;
      }

      #friendListContainer {
        background-color: #85d2ff;
        width: 100%; /* Default width in "public" */
        height: 400px; /* Collapsed height */
        border-radius: 15px;
        text-align: center;
        background-color: #85d2ff;
        border-color: #85d2ff;
      }

      /* Conversation modal improvements */
      /* filepath: c:\xampp\htdocs\onlyPets\ownerHome.html */
      #conversationModal .modal-content {
        border-radius: 18px;
        background: linear-gradient(135deg, #e3f6ff 60%, #fff 100%);
        box-shadow: 0 8px 32px rgba(56, 182, 255, 0.15);
        border: none;
        padding: 0;
      }
      #conversationModal .modal-header {
        border-bottom: none;
        background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
        color: #fff;
        border-top-left-radius: 18px;
        border-top-right-radius: 18px;
        padding-top: 1.2rem;
        padding-bottom: 1.2rem;
      }
      #conversationModal .modal-title {
        font-weight: 700;
        font-size: 1.2rem;
        letter-spacing: 1px;
      }
      #conversationModal .modal-body {
        background: #fafdff;
        padding: 1.5rem 1.2rem 1rem 1.2rem;
        min-height: 300px;
        max-height: 400px;
        overflow-y: auto;
      }
      #conversationModal .modal-footer {
        border-top: none;
        background: #fafdff;
        padding: 1rem 1.2rem;
        border-bottom-left-radius: 18px;
        border-bottom-right-radius: 18px;
      }
      #conversationModal #messageInput {
        border-radius: 20px;
        border: 1.5px solid #b6e0fa;
        background: #fff;
        font-size: 1rem;
        margin-right: 8px;
        box-shadow: none;
        transition: border-color 0.2s;
      }
      #conversationModal #sendButton {
        border-radius: 20px;
        background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
        color: #fff;
        font-weight: 700;
        border: none;
        padding: 0.5rem 1.5rem;
        transition: background 0.3s;
      }
      #conversationModal #sendButton:hover {
        background: linear-gradient(90deg, #1e90ff 0%, #38b6ff 100%);
      }
    </style>
  </head>
  <body>
    <div id="loadingScreen" style="display: none">
      <img src="media/images/utilities/loading.gif" alt="Loading..." />
    </div>

    <div
      class="modal fade"
      id="imageModal"
      tabindex="-1"
      aria-labelledby="imageModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header justify-content-center">
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <img
              id="modalImage"
              src=""
              alt="Enlarged Image"
              class="img-fluid rounded"
            />
          </div>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <!-- Brand/Logo -->
        <a class="navbar-brand" href="ownerHome.html">
          <img src="media/images/utilities/pawing.png" alt="Logo" height="40" />
        </a>

        <!-- Centered Buttons -->
        <div class="d-flex contentType">
          <button
            class="btn me-2 contentTypeButtonActive"
            id="personalizedButton"
          >
            Personalized
          </button>
          <button class="btn contentTypeButtonDeactive" id="publicButton">
            Public
          </button>
        </div>

        <!-- Right-Side Icons -->
        <div class="d-flex">
          <!-- Search Bar Icon -->

          <a href="#" class="nav-link">
            <i class="fas fa-search fa-lg search-icon me-3" id="searchIcon"></i>
          </a>

          <!-- Chat Icon -->
          <a href="#" class="nav-link position-relative" id="chatIcon">
            <i class="fas fa-comments fa-lg me-3"></i>
            <span
              id="chatBadge"
              style="
                display: none;
                position: absolute;
                top: 2px;
                right: 2px;
                background: red;
                color: white;
                border-radius: 50%;
                width: 18px;
                height: 18px;
                font-size: 12px;
                text-align: center;
                line-height: 18px;
              "
            ></span>
          </a>

          <!-- Notification Icon -->
          <a href="#" id="bellIcon" class="nav-link">
            <i class="fas fa-bell fa-lg me-3"></i>
          </a>
        </div>
      </div>
    </nav>

    <div
      class="modal fade"
      id="searchModal"
      tabindex="-1"
      aria-labelledby="searchModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <!-- Changed to extra-large modal -->
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h5 class="modal-title" id="searchModalLabel">Search</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <!-- Modal Body -->
          <div class="modal-body">
            <!-- Enlarged Search Bar -->
            <input
              type="text"
              id="searchInput"
              class="form-control mb-4"
              placeholder="Search for users, pets, or topics..."
            />
            <div
              id="searchSuggestions"
              class="list-group mb-3"
              style="display: none"
            ></div>

            <!-- Recent Searches Title -->
            <h6 class="mb-3">Recent Searches</h6>

            <!-- Recent Searches in Two Rows -->
            <div id="recentSearches" class="row">
              <!-- Search Item 1 -->
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="d-flex align-items-center border rounded p-2">
                  <img
                    src="media/images/profiles/123.jpg"
                    alt="Profile"
                    class="rounded-circle me-3"
                    width="50"
                    height="50"
                  />
                  <div>
                    <strong>John Doe</strong><br />
                    <small class="text-muted">New York, USA</small>
                  </div>
                </div>
              </div>

              <!-- Search Item 2 -->
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="d-flex align-items-center border rounded p-2">
                  <img
                    src="media/images/profiles/456.jpg"
                    alt="Profile"
                    class="rounded-circle me-3"
                    width="50"
                    height="50"
                  />
                  <div>
                    <strong>Emma Smith</strong><br />
                    <small class="text-muted">Los Angeles, USA</small>
                  </div>
                </div>
              </div>

              <!-- Search Item 3 -->
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="d-flex align-items-center border rounded p-2">
                  <img
                    src="media/images/profiles/789.jpg"
                    alt="Profile"
                    class="rounded-circle me-3"
                    width="50"
                    height="50"
                  />
                  <div>
                    <strong>Oliver Brown</strong><br />
                    <small class="text-muted">Chicago, USA</small>
                  </div>
                </div>
              </div>

              <!-- Search Item 4 -->
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="d-flex align-items-center border rounded p-2">
                  <img
                    src="media/images/profiles/321.jpg"
                    alt="Profile"
                    class="rounded-circle me-3"
                    width="50"
                    height="50"
                  />
                  <div>
                    <strong>Sophia Lee</strong><br />
                    <small class="text-muted">San Francisco, USA</small>
                  </div>
                </div>
              </div>

              <!-- Search Item 5 -->
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="d-flex align-items-center border rounded p-2">
                  <img
                    src="media/images/profiles/654.jpg"
                    alt="Profile"
                    class="rounded-circle me-3"
                    width="50"
                    height="50"
                  />
                  <div>
                    <strong>Michael Green</strong><br />
                    <small class="text-muted">Houston, USA</small>
                  </div>
                </div>
              </div>

              <!-- Search Item 6 -->
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="d-flex align-items-center border rounded p-2">
                  <img
                    src="media/images/profiles/987.jpg"
                    alt="Profile"
                    class="rounded-circle me-3"
                    width="50"
                    height="50"
                  />
                  <div>
                    <strong>Emily Davis</strong><br />
                    <small class="text-muted">Miami, USA</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="chatDropdown"></div>

    <div
      class="modal fade"
      id="conversationModal"
      tabindex="-1"
      aria-labelledby="conversationModalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="conversationModalTitle" class="modal-title">
              Chat with <span id="userName"></span>
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="conversationContent">
            <!-- Chat content will be dynamically loaded here -->
          </div>
          <div class="modal-footer">
            <div class="input-group">
              <input
                type="text"
                id="messageInput"
                class="form-control"
                placeholder="Type a message..."
              />
              <button type="button" class="btn btn-primary" id="sendButton">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="bellDropdown">
      <!-- Add more messages as needed -->
    </div>
    <!-- Notification Modal -->

    <!-- Sidebar -->
    <div id="mySidebar" class="sidebar">
      <!-- Top Links -->
      <div class="top-links">
        <a href="ownerHome.html" class="loading-link"
          ><i class="fas fa-home active"></i
        ></a>
        <a href="ownerVet.html" class="loading-link"
          ><i class="fas fa-stethoscope deactive"></i
        ></a>
        <a href="ownerCommunity.html" class="loading-link"
          ><i class="fas fa-users deactive"></i
        ></a>
      </div>

      <!-- Bottom Icon -->
      <a href="ownerProfile.html" class="bottom-icon pet-item-profile"
        ><img src="" id="sideProfile" alt="Pet 1" class="pet-img-profile me-2"
      /></a>
    </div>

    <div id="main" class="container-fluid">
      <div class="row mainContent">
        <!-- Left Content -->
        <div id="leftContent" class="col-md-2"></div>
        <div id="centerContent" class="col-md-7">
          <div id="personalizedContainer">
            <div class="post-list"></div>
          </div>

          <div id="publicContainer" class="hidden">
            <div class="post-list"></div>
          </div>
        </div>

        <!-- Post Preview Modal -->
        <div
          class="modal fade"
          id="postPreviewModal"
          tabindex="-1"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content p-3">
              <div class="modal-header">
                <h5 class="modal-title">Post Preview</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>

              <div class="modal-body">
                <p id="previewCaption" class="mb-3"></p>

                <div
                  id="previewMedia"
                  class="d-flex flex-wrap gap-2 mb-3"
                ></div>

                <select id="postScopeMain" class="form-select mb-2">
                  <option value="public">Public</option>
                  <option value="friends">Friends</option>
                  <option value="private">Private</option>
                </select>

                <input
                  type="text"
                  id="taggedUsers"
                  class="form-control mb-2"
                  placeholder="Tag people (comma-separated emails)"
                />
                <div
                  id="taggedUsersSuggestions"
                  class="list-group position-absolute w-100 shadow rounded border border-warning"
                  style="
                    z-index: 1050;
                    display: none;
                    max-height: 220px;
                    overflow-y: auto;
                    background: #fff;
                  "
                >
                  <!-- Suggestions will be injected here by JS -->
                </div>
                <input
                  type="text"
                  id="taggedPets"
                  class="form-control mb-2"
                  placeholder="Tag pets (comma-separated pet names)"
                />
              </div>

              <div class="modal-footer">
                <button id="submitPost" class="btn btn-warning">
                  Confirm Post
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Content -->
        <div id="rightContent" class="col-md-3">
          <div id="postComposer" class="card p-3">
            <h5>Compose a Post</h5>
            <br />
            <textarea
              id="postText"
              class="form-control mb-2"
              rows="3"
              placeholder="What's on your mind?"
            ></textarea>

            <!-- Allow multiple images/videos -->
            <input
              type="file"
              id="postMedia"
              class="form-control mb-2"
              multiple
              accept="image/*,video/*"
            />

            <!-- Preview container -->
            <div id="mediaPreview" class="mb-2 d-flex flex-wrap gap-2"></div>

            <button id="postButton" class="btn btn-warning w-100">Post</button>
          </div>

          <div
            class="friend-profile-container text-center mt-5 card p-3"
            id="friendListContainer"
          >
            <h5 style="font-weight: 900">Friends</h5>
            <br />

            <div class="petCollection">
              <ul class="list-group" id="friendList"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="mediaModal"
      tabindex="-1"
      aria-labelledby="mediaModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="mediaModalLabel">Media Viewer</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div
            class="modal-body"
            id="mediaModalBody"
            style="text-align: center"
          ></div>
          <div class="modal-footer justify-content-between">
            <button
              type="button"
              class="btn btn-outline-primary"
              id="mediaModalPrev"
            >
              Prev
            </button>
            <button
              type="button"
              class="btn btn-outline-primary"
              id="mediaModalNext"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Comment Modal -->
    <div
      class="modal fade"
      id="commentModal"
      tabindex="-1"
      aria-labelledby="commentModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="commentModalLabel">Comments</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="commentModalBody">
            <!-- Post details and comments will be injected here by JS -->
          </div>
          <div class="modal-footer">
            <input
              type="text"
              class="form-control"
              id="newCommentInput"
              placeholder="Write a comment..."
            />
            <button type="button" class="btn btn-primary" id="submitCommentBtn">
              Post
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- AJAX link -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="jsFile/globalSide/getSessionInfo.js"></script>
    <script src="jsFile/userSide/ownerHome.js"></script>
    <script>
      // JS for the loading page

      function showLoadingScreen() {
        document.getElementById("loadingScreen").style.display = "flex";
      }

      function hideLoadingScreen() {
        document.getElementById("loadingScreen").style.display = "none";
      }

      window.addEventListener("load", hideLoadingScreen);

      window.addEventListener("beforeunload", showLoadingScreen);

      $(document).ready(function () {
        $("#personalizedButton").click(function () {
          $("#personalizedContainer").removeClass("hidden");
          $("#publicContainer").addClass("hidden");
          $(this)
            .addClass("contentTypeButtonActive")
            .removeClass("contentTypeButtonDeactive");
          $("#publicButton")
            .addClass("contentTypeButtonDeactive")
            .removeClass("contentTypeButtonActive");
        });

        $("#publicButton").click(function () {
          $("#publicContainer").removeClass("hidden");
          $("#personalizedContainer").addClass("hidden");
          $(this)
            .addClass("contentTypeButtonActive")
            .removeClass("contentTypeButtonDeactive");
          $("#personalizedButton")
            .addClass("contentTypeButtonDeactive")
            .removeClass("contentTypeButtonActive");
        });
      });

      // Open Search Modal when the search icon is clicked
      document
        .getElementById("searchIcon")
        .addEventListener("click", function () {
          const searchModal = new bootstrap.Modal(
            document.getElementById("searchModal")
          );
          searchModal.show();
        });

      $("#chatIcon").click(function () {
        $("#chatDropdown").toggle();
      });

      // Close the dropdown if clicked outside
      $(document).click(function (event) {
        if (!$(event.target).closest("#chatIcon, #chatDropdown").length) {
          $("#chatDropdown").hide();
        }
      });

      $("#bellIcon").click(function () {
        $("#bellDropdown").toggle();
      });

      // Close the dropdown if clicked outside
      $(document).click(function (event) {
        if (!$(event.target).closest("#bellIcon, #bellDropdown").length) {
          $("#bellDropdown").hide();
        }
      });

      // $(document).ajaxStart(function() {
      //     showLoadingScreen();
      // });

      // $(document).ajaxComplete(function() {
      //     hideLoadingScreen();
      // });

      // $('form').on('submit', function() {
      //     showLoadingScreen();
      // });

      document.querySelectorAll(".chat-message").forEach((message) => {
        message.addEventListener("click", function () {
          const userName = this.getAttribute("data-user");
          const userMessage = this.getAttribute("data-text");

          // Update modal content
          document.getElementById("userName").textContent = userName;
          document.getElementById("conversationContent").innerHTML = `
                    <div class="d-flex align-items-start mb-3">
                        <img src="media/images/default-profile.png" class="rounded-circle me-2" width="40" height="40" alt="${userName}">
                        <div class="bg-light p-2 rounded">
                            <strong>${userName}:</strong> ${userMessage}
                        </div>
                    </div>
                    <div class="d-flex align-items-start justify-content-end mb-3">
                        <div class="bg-primary text-white p-2 rounded">
                            <strong>You:</strong> Sure! Let me check.
                        </div>
                    </div>
                `;

          // Show modal
          const conversationModal = new bootstrap.Modal(
            document.getElementById("conversationModal")
          );
          conversationModal.show();
        });
      });

      // Apply the loading screen to links with the loading-link class
      document.querySelectorAll("a.loading-link").forEach(function (anchor) {
        anchor.addEventListener("click", function () {
          showLoadingScreen();
        });
      });

      function showImage(imgElement) {
        // Get the source of the clicked image
        var imageSrc = imgElement.src;

        // Set the source of the modal image to the clicked image
        document.getElementById("modalImage").src = imageSrc;
      }

      // JS for the Side Bar ------------------------------------------------------
      document.querySelectorAll(".chat-message").forEach((message) => {
        message.addEventListener("click", function () {
          const userName = this.getAttribute("data-user");
          const userMessage = this.getAttribute("data-text");

          // Update modal content
          document.getElementById("userName").textContent = userName;
          document.getElementById("conversationContent").innerHTML = `
                    <div class="d-flex align-items-start mb-3">
                        <img src="media/images/default-profile.png" class="rounded-circle me-2" width="40" height="40" alt="${userName}">
                        <div class="bg-light p-2 rounded">
                            <strong>${userName}:</strong> ${userMessage}
                        </div>
                    </div>
                    <div class="d-flex align-items-start justify-content-end mb-3">
                        <div class="bg-primary text-white p-2 rounded">
                            <strong>You:</strong> Sure! Let me check.
                        </div>
                    </div>
                `;

          // Show modal
          const conversationModal = new bootstrap.Modal(
            document.getElementById("conversationModal")
          );
          conversationModal.show();
        });
      });

      function filterCategories() {
        const searchInput = document
          .getElementById("categorySearch")
          .value.toLowerCase();
        const items = document.querySelectorAll(".category-item");

        items.forEach((item) => {
          const text = item.textContent.toLowerCase();
          if (text.includes(searchInput)) {
            item.style.display = "block";
          } else {
            item.style.display = "none";
          }
        });
      }

      document.querySelectorAll(".chat-item").forEach((item) => {
        item.addEventListener("click", function () {
          const customerName = this.getAttribute("data-customer");
          const lastMessage = this.getAttribute("data-message");

          // Set modal title and load chat content
          document.getElementById("customerName").textContent = customerName;
          document.getElementById("chatContent").innerHTML = `
                    <div class="d-flex align-items-start mb-3">
                        <img src="media/images/default-profile.png" class="rounded-circle me-2" width="40" height="40" alt="${customerName}">
                        <div class="bg-light p-2 rounded">
                            <strong>${customerName}:</strong> ${lastMessage}
                        </div>
                    </div>
                    <div class="d-flex align-items-start justify-content-end mb-3">
                        <div class="bg-primary text-white p-2 rounded">
                            <strong>You:</strong> Sure! Let me check.
                        </div>
                    </div>
                `;

          // Initialize modals
          const viewChatModalElement = document.getElementById("viewChat");
          const chatModalElement = document.getElementById("chatModal");

          const viewChatModal =
            bootstrap.Modal.getInstance(viewChatModalElement) ||
            new bootstrap.Modal(viewChatModalElement);
          const chatModal =
            bootstrap.Modal.getInstance(chatModalElement) ||
            new bootstrap.Modal(chatModalElement);

          // Hide the viewChat modal and show the chatModal
          viewChatModal.hide();
          chatModal.show();
        });
      });

      $("#viewChatsButton").on("click", function () {
        const viewChatModalElement = document.getElementById("viewChat");
        const viewChatModal =
          bootstrap.Modal.getInstance(viewChatModalElement) ||
          new bootstrap.Modal(viewChatModalElement);
        viewChatModal.show();
      });

      // JS for the Side Bar ------------------------------------------------------

      // Pet Type and Breed Selection
      $(document).ready(function () {
        // Fetch all pet types and breeds from the new PHP endpoint
        $.getJSON("phpFile/globalSide/getPetTypesBreeds.php", function (data) {
          // Store the breeds for each type in a JS object for quick lookup
          let typeBreedsMap = {};
          $("#pet_type")
            .empty()
            .append('<option value="">Select Type</option>');
          data.forEach(function (item) {
            $("#pet_type").append(
              `<option value="${item.id}">${item.pet_type}</option>`
            );
            typeBreedsMap[item.id] = item.pet_breeds; // pet_breeds is an array
          });

          // When pet type changes, update breeds dropdown
          $("#pet_type").on("change", function () {
            let selectedId = $(this).val();
            $("#pet_breed")
              .empty()
              .append('<option value="">Select Breed</option>');
            if (selectedId && typeBreedsMap[selectedId]) {
              typeBreedsMap[selectedId].forEach(function (breed) {
                $("#pet_breed").append(
                  `<option value="${breed}">${breed}</option>`
                );
              });
            }
            $("#pet_breed").trigger("change.select2");
          });
        });

        // Initialize Select2 for both dropdowns
        $("#pet_type").select2({
          dropdownParent: $("#addPetModal"),
          width: "100%",
          placeholder: "Select Type",
        });
        $("#pet_breed").select2({
          dropdownParent: $("#addPetModal"),
          width: "100%",
          placeholder: "Select Breed",
          language: {
            noResults: function (params) {
              // If no pet type is selected, show custom message
              if (!$("#pet_type").val()) {
                return "Select your Pet Type first";
              }
              return "No results found";
            },
          },
        });
      });

      var sessionUserId = null;
      $.getJSON("phpFile/globalSide/getSessionInfo.php", function (response) {
        if (response.status === "success" && response.data.user_id) {
          sessionUserId = response.data.user_id;
          loadChats();
        } else {
          alert("Not logged in or session error.");
        }
      });
      let chatListInterval = null;
      let conversationInterval = null;
      let isConversationOpen = false;

      function loadChats() {
        $.get("phpFile/globalSide/getChats.php", function (data) {
          let users = data;
          if (typeof data === "string") {
            try {
              users = JSON.parse(data);
            } catch (e) {
              users = [];
            }
          }
          let html = `
                    <div class="px-3 pt-3 pb-2">
                        <h5 class="fw-bold mb-0" style="color:#1976d2;">Chats</h5>
                    </div>
                    <hr class="my-0">
                `;
          let hasUnread = false;
          let unreadTotal = 0;
          users.forEach((user) => {
            // Use fallback for profile image
            const img = user.profile_img
              ? "media/images/profiles/" + user.profile_img
              : "media/images/default-profile.png";
            // Use fallback for name
            const name =
              user.user_fname && user.user_lname
                ? user.user_fname + " " + user.user_lname
                : user.name || "Unknown";
            html += `
                <div class="chat-message" data-user-id="${
                  user.id
                }" data-user-name="${name}">
                    <img class="profile-img" src="${img}" alt="Profile Picture">
                    <div class="message-details">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="name">${name}</span>
                            <span class="time">${user.sent_at || ""}</span>
                        </div>
                        <span class="message">${user.last_message || ""}</span>
                    </div>
                </div>
            `;
            if (user.unread_count && user.unread_count > 0) {
              hasUnread = true;
              unreadTotal += user.unread_count;
            }
          });
          $("#chatDropdown").html(html);

          // Show or hide the badge
          if (hasUnread) {
            $("#chatBadge").text(unreadTotal).show();
          } else {
            $("#chatBadge").hide();
          }
          // Add click event to open chat modal
          $(".chat-message").click(function () {
            currentChatUserId = $(this).data("user-id");
            $("#userName").text($(this).data("user-name"));
            loadMessages(currentChatUserId);

            // Mark messages as read for this conversation
            $.post(
              "phpFile/globalSide/markMessageRead.php",
              { other_user_id: currentChatUserId },
              function (res) {
                loadChats(); // Refresh badge after marking as read
              }
            );

            // Stop chat list polling when modal is open
            if (chatListInterval) clearInterval(chatListInterval);

            // Start conversation polling
            if (conversationInterval) clearInterval(conversationInterval);
            conversationInterval = setInterval(function () {
              loadMessages(currentChatUserId);
            }, 2000);

            isConversationOpen = true;
            const conversationModal = new bootstrap.Modal(
              document.getElementById("conversationModal")
            );
            conversationModal.show();
          });
        }).fail(function (jqXHR, textStatus, errorThrown) {
          $("#chatDropdown").html(
            '<div class="text-danger text-center py-4">Failed to load chats.</div>'
          );
        });
      }

      // Start polling chat list every 5 seconds (when modal is closed)
      function startChatListPolling() {
        if (chatListInterval) clearInterval(chatListInterval);
        chatListInterval = setInterval(function () {
          if (!isConversationOpen) loadChats();
        }, 3000);
      }

      // Stop conversation polling and resume chat list polling when modal closes
      $("#conversationModal").on("hidden.bs.modal", function () {
        if (conversationInterval) clearInterval(conversationInterval);
        isConversationOpen = false;
        startChatListPolling();
      });

      // Initial load and polling
      $(document).ready(function () {
        loadChats();
        startChatListPolling();
      });

    

      // When opening the chat modal
      $(".chat-message").click(function () {
        currentChatUserId = $(this).data("user-id");
        $("#userName").text($(this).data("user-name"));

        loadMessages(currentChatUserId);

        // Start polling every 2 seconds
        if (conversationInterval) clearInterval(conversationInterval);
        conversationInterval = setInterval(function () {
          loadMessages(currentChatUserId);
        }, 2000); // Changed to 2000ms (2s) from 300ms to avoid spamming server

        const conversationModal = new bootstrap.Modal(
          document.getElementById("conversationModal")
        );
        conversationModal.show();
      });

      // Scroll to bottom again when modal is fully shown (optional, but safe)
      $("#conversationModal").on("shown.bs.modal", function () {
        const $conversation = $("#conversationContent");
        $conversation.scrollTop($conversation[0].scrollHeight);
      });

      // Stop polling when modal closes
      $("#conversationModal").on("hidden.bs.modal", function () {
        if (conversationInterval) clearInterval(conversationInterval);
        conversationInterval = null;
        currentChatUserId = null;
      });

      // Send message on button click
      $("#sendButton").off("click").on("click", function () {
        const message = $("#messageInput").val().trim();
        if (!message || !currentChatUserId) return;

        $.post(
          "phpFile/globalSide/sendMessage.php",
          {
            receiver_id: currentChatUserId,
            message: message,
          },
          function (response) {
            $("#messageInput").val("");
            loadMessages(currentChatUserId, function () {
              const $conversation = $("#conversationContent");
              $conversation.scrollTop($conversation[0].scrollHeight);
            });
            loadChats();
          },
          "json"
        );
      });

      // Optional: Send on Enter key
      $("#messageInput").keypress(function (e) {
        if (e.which === 13) {
          $("#sendButton").click();
          return false;
        }
      });

      $(document).ready(function () {
        $("#chatBadge").show().text("1");
      });

      // Helper: Get query param from URL (if you want to support ?email=... links)
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // If you want to support opening chat by email in URL
      const email = getQueryParam("email");
      if (email) {
        $.get(
          "phpFile/globalSide/getUserIdByEmail.php",
          { email: email },
          function (response) {
            if (typeof response === "string") response = JSON.parse(response);
            if (response.status === "success") {
              $("#profileContainer").attr("data-user-id", response.user_id);
            }
          }
        );
      }

      // Message button click handler (for profile pages or friend lists)
      $("#messageBtn").click(function () {
        // You may need to adjust this selector if your user ID/name is stored elsewhere
        const otherUserId = $("#profileContainer").data("user-id");
        const otherUserName = $("#fullName").text();

        if (!otherUserId) {
          alert("User ID not found.");
          return;
        }

        currentChatUserId = otherUserId;
        $("#userName").text(otherUserName);

        const conversationModal = new bootstrap.Modal(
          document.getElementById("conversationModal")
        );
        conversationModal.show();

        // Load messages and scroll to bottom after loading
        loadMessages(currentChatUserId, function () {
          const $conversation = $("#conversationContent");
          $conversation.scrollTop($conversation[0].scrollHeight);
        });

        // Mark messages as read
        $.post(
          "phpFile/globalSide/markMessageRead.php",
          { other_user_id: currentChatUserId },
          function (res) {
            loadChats();
          }
        );
      });

      // Modify loadMessages to accept a callback (if not already)
function loadMessages(userId, callback) {
  $.get(
    "phpFile/globalSide/getConversation.php",
    { user_id: userId },
    function (data) {
      let messages = data;
      if (typeof data === "string") {
        try {
          messages = JSON.parse(data);
        } catch (e) {
          messages = [];
        }
      }
      let html = "";
      messages.forEach((msg) => {
        const isMe = msg.sender_id == sessionUserId;
        html += `
          <div class="d-flex ${isMe ? "justify-content-end" : "justify-content-start"} mb-2">
            <div class="${isMe ? "bg-primary text-white" : "bg-light"} p-2 rounded shadow-sm" style="max-width:70%;">
              <strong>${isMe ? "You" : msg.user_fname + " " + msg.user_lname}:</strong>
              ${msg.message}
              <div class="small text-muted text-end">${msg.sent_at}</div>
            </div>
          </div>
        `;
      });
      const $conversation = $("#conversationContent");
      $conversation.html(
        html || '<div class="text-center text-muted">No messages yet.</div>'
      );
      $conversation.scrollTop($conversation[0].scrollHeight);
      if (typeof callback === "function") callback();
    }
  );
}
    </script>
  </body>
</html>
