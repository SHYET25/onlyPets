<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="icon" href="media/images/utilities/paw.png" type="image/png">

    <!-- BS LINKS -->
    <!-- <link rel="stylesheet" href="../../bsCSS/bootstrap.css">
    <link rel="stylesheet" href="../../bsCSS/bootstrap.min.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    

    <!-- Font Awesome Link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <!-- Page CSS and JS -->
    <link rel="stylesheet" href="cssFile/userSide/ownerProfile.css">

    <style>
   

        *::-webkit-scrollbar {
            width: 8px;
        }
        *::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        *::-webkit-scrollbar-thumb {
            background-color: #cccccc;
            border-radius: 10px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #38b6ff;
            margin: 0;
            padding: 0;
            font-family: helvetica, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Navbar Styles */
        .navbar {
            background-color: transparent;
            color: white;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 1rem 0.3rem;
        }

        .navbar .navbar-brand img {
            height: 50px;
            width: 65%;
            margin-left: 30px;
        }

        .navbar .nav-item .nav-link {
            color: white;
            font-size: 16px;
            font-weight: 500;
            transition: color 0.3s;
            margin-right: 10px;
        }

        .navbar .nav-item .nav-link:hover {
            color: #f3f3f3;
        }

        .navbar .form-control {
            border-radius: 20px;
            display: none; /* Initially hidden */
        }

        .navbar .search-icon {
            font-size: 2rem; /* Increased size */
            cursor: pointer;
            color: black;
        }

        .navbar .search-icon:hover {
            color: #f3f3f3;
        }

        .navbar .form-control.show {
            display: block; /* Show input when the icon is clicked */
        }

        /* Add equal margin between icons */
        .navbar .nav-link {
            margin-left: 15px;
          
        }

        
        /* Add equal margin between icons except the last child */
        .navbar .d-flex i {
            font-size: 2rem; /* Increase icon size */
            margin-left: 15px; /* Equal margin between icons */
            margin-left: 15px; /* Equal margin between icons */
            cursor: pointer;
            color: black;
            transition: color 0.3s;
        }
        
        /* Hover effect for icons */
        .navbar .d-flex i:hover {
            color: #f3f3f3;
        }

        /* Chat Dropdown & Message Styles - Match ownerProfile */
        #chatDropdown {
            display: none;
            position: absolute;
            top: 80px;
            right: 100px;
            background: #fff;
            box-shadow: 0 8px 32px rgba(56,182,255,0.15), 0 1.5px 8px rgba(0,0,0,0.08);
            border-radius: 18px;
            width: 370px;
            max-height: 500px;
            overflow-y: auto;
            padding: 0;
            z-index: 1050;
            border: none;
        }
        .chat-message {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            border-bottom: 1px solid #f1f1f1;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            background: transparent;
            position: relative;
        }
        .chat-message:last-child {
            border-bottom: none;
        }
        .chat-message:hover {
            background: #eaf6ff;
            box-shadow: 0 2px 8px rgba(56,182,255,0.08);
        }
        .profile-img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #38b6ff22;
            background: #f3f3f3;
        }
        .message-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }
        .name {
            font-weight: 700;
            color: #1976d2;
            font-size: 1.05rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .message {
            color: #555;
            font-size: 0.97rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }
        .time {
            font-size: 0.85rem;
            color: #aaa;
            align-self: flex-end;
            margin-top: 2px;
        }
        #chatDropdown::-webkit-scrollbar {
            width: 6px;
        }
        #chatDropdown::-webkit-scrollbar-thumb {
            background-color: #ddd;
            border-radius: 3px;
        }
        #chatDropdown::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }
        #bellDropdown {
            display: none;
            position: absolute;
            top: 80px;
            right: 30px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            width: 400px; /* Adjusted width for better visibility */
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }
        
        .notification-message {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start;
            padding: 5px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .notification-message:last-child {
            border-bottom: none;
        }
        
        .profile-img {
            width: 45px; /* Adjusted size for better proportion */
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }
        
        .notification-details {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .name {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 3px;
        }
        
        .notification {
            font-size: 13px;
            color: #555;
            line-height: 1.4;
            margin-bottom: 5px;
        }
        
        .time {
            font-size: 11px;
            color: #aaa;
            align-self: flex-end;
        }
        
        .notification-message:hover {
            background-color: #f9f9f9;
            cursor: pointer;
        }
        
        #bellDropdown::-webkit-scrollbar {
            width: 6px;
        }
        
        #bellDropdown::-webkit-scrollbar-thumb {
            background-color: #ddd;
            border-radius: 3px;
        }
        
        #bellDropdown::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }
    
        /* Sidebar Styling */
        .sidebar {
            height: calc(100% - 100px);
            width: 80px;
            position: fixed;
            top: 54%;
            left: 30px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Space between top links and bottom icon */
            align-items: center; /* Center items horizontally */
            padding-top: 10px;
            padding-bottom: 10px;
            margin-top: 10px;
        }
        
        .sidebar a {
            margin-bottom: 10px; /* Adjust spacing between top links */
            text-decoration: none;
            font-size: 2rem;
            color: #333333;
            display: block;
            transition: 0.3s;
        }
        .petList5 {
            font-weight: 900;
            background-color: #38b6ff;
            padding: 10px;
            width: 100%;
            border-radius: 10px;
           
        }

        .petList5 h5{
            font-weight: 900;
            background-color: #38b6ff;
           
        }
        
        .sidebar a:hover {
            color: #ffff;
        }

            /* Make the icon's background red and circular when active */
        .sidebar .top-links a .active {
            background-color: #38b6ff;
            border-radius: 50%;
            color: #000; /* Change icon color to white */
            padding: 10px; /* Add some padding for the circular effect */
        }

        .sidebar .top-links a i {
            transition: all 0.3s ease; /* Smooth transition for background color and size */
        }

        /* Hover effect for icons */
        .sidebar .top-links a:hover .active {
            background-color: #38b6ff;
            color: white;
        }

        /* Ensure the inactive state doesn't have the circle background */
        .sidebar .top-links a i {
            background: none;
            border-radius: 0;
        }

        .sidebar .top-links a .deactive {
            background-color: transparent;
            border-radius: 50%;
            color: #000; /* Change icon color to white */
            padding: 10px; /* Add some padding for the circular effect */
            font-size: 2rem;
        }

        /* Hover effect for icons */
        .sidebar .top-links a:hover .deactive {
            background-color: transparent;
            color: white;
            font-size: 2rem;
        }



        
        .sidebar .bottom-icon {
            margin-bottom: 10px; /* Keep space from the bottom of the sidebar */
            color: #333333;
            font-size: 2rem;
            transition: 0.3s;
        }
        
        .sidebar .bottom-icon:hover {
            color: #ffffff;
        }

        .top-links a {
            /* No margin applied here so the first child stays at the top */
            padding-top: 20px;
        }
        
        .top-links a:not(:first-child) {
            margin-top: 20px; /* Add margin only to links except the first one */
        }
        
        
        

        /* Main content area */
        #main {
            background-color: #38b6ff;
            background-image: url('media/images/utilities/bgMain.png'); /* Update this line */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100%;
            overflow-x: hidden;
            padding-top: 10vh;
        }
        

        .active {
            color: white;
        }

        #imageModal{
            z-index: 10000;
        }

        #loadingScreen {
            display: none; /* Initially hidden */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            z-index: 10000; /* Ensure it's above other content */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #loadingScreen img {
            width: 300px; /* Adjust size as needed */
            height: 400px; /* Adjust size as needed */
        }

        /* Responsive Table */
        .table-responsive {
            overflow-x: auto;
        }

        .active {
            color:white;
        }

        hr{
            color:gray;
            
        }

        .contentType{
            margin-left: 0px;
        }

        .contentTypeButtonDeactive {
            margin-left: 100px;
            background-color: transparent;
            border-radius: 25px;
            width: 150px;
            font-weight: 900;
        }

        .contentTypeButtonActive {
            margin-left: 100px;
            background-color: #ffde59;
            border-radius: 25px;
            width: 150px;
            font-weight: 900;
        }

        .contentTypeButtonActive:hover {
            margin-left: 100px;
            background-color: #9c7d00;
            border-radius: 25px;
            width: 150px;
            font-weight: 900;
        }

        #main {
            background-color: #38b6ff;
            background-image: url('media/images/utilities/bgMain.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100%;
            overflow-x: hidden;
            overflow-y: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 80%;
            margin-top: 30px;
        }

        .hidden {
            display: none;
        }


        #otherProfilePosts {
            height: 100%;
            overflow: hidden;
            scrollbar-gutter: stable;
            padding: 10px;
        }
        #otherProfilePosts:hover {
            overflow-y: auto;
            scrollbar-gutter: stable;
        }
        #otherUserPostsContainer {
            width: 100%;
            margin-top: 20px;
        }
        

        #centerContent {
       
            height: 100%; /* Match height with the main section */
            padding: 0%;
            scrollbar-gutter: stable; /* Prevent scrollbar shift */
            overflow: hidden;
            padding: 10px;
        }

        

        
        
        
        .mainContent{
        
            height: 100%;
            margin-top: 0.5%;
            width: 100%;
        }

        #postComposer {
            width: 100%; /* Default width in "public" */
            height: 60px; /* Collapsed height */
            overflow: hidden; /* Hide content when collapsed */
            transition: height 0.6s ease; /* Smooth transition for height */
            border-radius: 15px;
            text-align: center;
            background-color: #85d2ff;
            border-color: #85d2ff;
        }

        #petMateList {
            width: 100%; /* Default width in "public" */
            margin-top: 10px;
            height: 63%; /* Collapsed height */
            overflow: hidden;
            border-radius: 15px;
            text-align: center;
            background-color: #85d2ff;
            border-color: #85d2ff;
        }

        .petListH5 {
            font-weight: 900;
            background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
            padding: 12px 0;
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(56,182,255,0.08);
            letter-spacing: 1px;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.07);
            margin-bottom: 0;
            border-bottom: 2px solid #38b6ff33;
            text-align: center;
           
        }

        .petListH5 h5{
            font-weight: 900;
           
        }

        #postComposer h5{
           font-weight: 900;
        }

        

        .petCollection {
            height: 100%;
           
            scrollbar-gutter: stable; 
            overflow: hidden;
        }

        .petCollection:hover {
            overflow: auto;
            scrollbar-gutter: stable; /* Prevent scrollbar shift */
            height: 100%;
        }


        
        #postComposer:hover {
            height: 27%; /* Expand to a fixed height on hover */
        }
        
        /* Add this fallback to ensure consistent behavior */
        #postComposer:focus,
        #postComposer:active {
            width: 100%; /* Maintain 100% width if focused or active */
            height: 220px; /* Set height to same as hover to maintain consistency */
        }

        .pet-img, .friend-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        #petList{
            margin-top: 10px;
        }

        .pet-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .pet-img-profile {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 3px;
        }


        .pet-item:hover {
            background-color: #f1f1f1;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .pet-item {
            
            
            padding: 10px;
        }
        
        
        .pet-item img {
            border: 2px solid #007bff;
        }

        .pet-item-profile img{
            border: 4px solid #000;
        }

        .pet-name {
            flex: 1; /* Ensures the name stays on the leftmost side */
            text-align: left; /* Align text to the left */
        }
        
        

        .product-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .product-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .product-card-img-top {
            height: 180px;
            object-fit: cover;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        
        .product-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .product-card-text {
            font-size: 1rem;
            color: #28a745;
        }
        
        #customerChats {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
            height: 35%;
        }
        
        .chat-item:hover {
            background-color: #f1f1f1;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        
        .chat-item img {
            border: 2px solid #007bff;
        }

        #cartIcon {
            margin-right: 20px;
        }
        
        #sellItem {
            margin-top: 10px;
            border-radius: 15px;
        }
        
        #postButton {
            font-weight: 700;
        }

        #chatList {
            overflow: hidden;
            scrollbar-gutter: stable; /* Prevent scrollbar shift */
        }


        #chatList:hover {
            overflow-y: auto; /* Add scroll if content overflows */
            scrollbar-gutter: stable; /* Prevent scrollbar shift */
            
        }

        #otherUserPostsContainer {
            width: 100%; /* Full width */
            margin-top: 20px; /* Spacing from top */
        }
        
        /* Add any additional styling for the posts container if needed */
        
        /* Conversation modal improvements */
        #conversationModal .modal-content {
            border-radius: 18px;
            background: linear-gradient(135deg, #e3f6ff 60%, #fff 100%);
            box-shadow: 0 8px 32px rgba(56,182,255,0.15);
            border: none;
            padding: 0;
        }

        #conversationModal .modal-header {
            border-bottom: none;
            background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
            color: #fff;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            padding-top: 1.2rem;
            padding-bottom: 1.2rem;
        }

        #conversationModal .modal-title {
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        #conversationModal .modal-body {
            background: #fafdff;
            padding: 1.5rem 1.2rem 1rem 1.2rem;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
        }

        #conversationModal .modal-footer {
            border-top: none;
            background: #fafdff;
            padding: 1rem 1.2rem;
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 18px;
        }

        #conversationModal #messageInput {
            border-radius: 20px;
            border: 1.5px solid #b6e0fa;
            background: #fff;
            font-size: 1rem;
            margin-right: 8px;
            box-shadow: none;
            transition: border-color 0.2s;
        }

        #conversationModal #sendButton {
            border-radius: 20px;
            background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
            color: #fff;
            font-weight: 700;
            border: none;
            padding: 0.5rem 1.5rem;
            transition: background 0.3s;
        }

        #conversationModal #sendButton:hover {
            background: linear-gradient(90deg, #1e90ff 0%, #38b6ff 100%);
        }

    </style>
</head>
<body>
    <div id="loadingScreen" style="display: none;">
            <img src="media/images/utilities/loading.gif" alt="Loading...">
    </div>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <!-- Brand/Logo -->
            <a class="navbar-brand" href="ownerHome.html">
                <img src="media/images/utilities/pawing.png" alt="Logo" height="40">
            </a>

            <!-- Centered Buttons -->
            <div class="d-flex contentType">
    
            </div>

            <!-- Right-Side Icons -->
            <div class="d-flex">
                <!-- Search Bar Icon -->

                <a href="#" class="nav-link" id="searchIcon">
                    <i class="fas fa-search fa-lg search-icon me-3"></i>
                </a>

                <!-- Chat Icon -->
                <a href="#" class="nav-link position-relative" id="chatIcon">
                    <i class="fas fa-comments fa-lg me-3"></i>
                    <span id="chatBadge" style="display:none; position:absolute; top:2px; right:2px; background:red; color:white; border-radius:50%; width:18px; height:18px; font-size:12px; text-align:center; line-height:18px;">

                    </span>
                </a>

                <!-- Notification Icon -->
                <a href="#" id="bellIcon" class="nav-link">
                    <i class="fas fa-bell fa-lg me-3"></i>
                </a>
            </div>
        </div>
    </nav>

    <div id="chatDropdown"></div>
    
    <!-- Conversation Modal -->
    <div class="modal fade" id="conversationModal" tabindex="-1" aria-labelledby="conversationModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="conversationModalTitle" class="modal-title">Chat with <span id="userName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="conversationContent">
                    <!-- Chat content will be dynamically loaded here -->
                </div>
                <div class="modal-footer">
                    <div class="input-group">
                        <input type="text" id="messageInput" class="form-control" placeholder="Type a message...">
                        <button type="button" class="btn btn-primary" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="bellDropdown">
        <h4>Notifications</h4>
        <hr>
        <div class="notification-message">
            <img class="profile-img" src="media/images/profiles/321.jpg" alt="Profile Picture">
            <div class="notification-details">
                <p class="name">Jane Smith</p>
                <p class="notification">Reacted to your post.</p>
                <span class="time">10:32 AM</span>
            </div>
        </div>
        <div class="notification-message">
            <img class="profile-img" src="media/images/profiles/321.jpg" alt="Profile Picture">
            <div class="notification-details">
                <p class="name">Jane Smith</p>
                <p class="notification">Reacted to your post.</p>
                <span class="time">10:32 AM</span>
            </div>
        </div>
        <!-- Add more messages as needed -->
    </div>


    <!-- Sidebar -->
    <div id="mySidebar" class="sidebar">
        <!-- Top Links -->
        <div class="top-links">
            <a href="ownerHome.html" class="loading-link"><i class="fas fa-home deactive"></i></a>
    
            <a href="ownerVet.html" class="loading-link"><i class="fas fa-stethoscope deactive"></i></a>
            <a href="ownerCommunity.html" class="loading-link"><i class="fas fa-users deactive"></i></a>
        </div>
    
        <!-- Bottom Icon -->
        <a href="ownerProfile.html" class="bottom-icon pet-item-profile"><img src="" alt="Pet 1" id="sideProfile" class="pet-img-profile me-2"></a>
    </div>

    <div id="main" class="container-fluid">
        <div class="row mainContent">
            <!-- Left Content -->
            <div id="leftContent" class="col-md-2"></div>
            <div id="centerContent" class="col-md-7">
                <div id="otherProfilePosts">
                    <div class="post-list" id="otherUserPostsContainer"></div>
                </div>
            </div>

            <div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header justify-content-center position-relative">
                                <h5 class="modal-title text-center" id="commentModalLabel">Comments</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="top: 20px; right: 15px; position: absolute;"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Post Author Details -->
                                <div class="post-header d-flex align-items-center mb-3">
                                    <img src="media/images/profiles/123.jpg" alt="User Profile" class="profile-img me-3">
                                    <div>
                                        <div class="d-flex">
                                            <div class="fw-bold">John Doe</div>
                                            <span id="postScopeContainer"><i id="postScope" class="fa-solid fa-user-group"></i></span>
                                        </div>
                                        <div class="text-muted">Pet: Buddy</div>
                                    </div>
                                </div>
                                <!-- Post Content with Pictures -->
                                <div class="post-content mb-3">
                                    <p>This is a sample caption describing the photos below. Buddy enjoying a sunny day at the park!</p>
                                    <div class="row g-2">
                                        <div class="col-4">
                                            <img src="media/images/posts/buddy.jpg" alt="Buddy in the park" class="img-fluid rounded img-thumbnail">
                                        </div>
                                        <div class="col-4">
                                            <img src="media/images/posts/buddy.jpg" alt="Buddy playing with a ball" class="img-fluid rounded img-thumbnail">
                                        </div>
                                        <div class="col-4">
                                            <img src="media/images/posts/buddy.jpg" alt="Buddy resting" class="img-fluid rounded img-thumbnail">
                                        </div>
                                    </div>
                                </div>
                                <!-- Comments Section -->
                                <div id="commentsSection">
                                    <div class="comment mb-3">
                                        <div class="d-flex align-items-start">
                                            <img src="media/images/profiles/456.jpg" alt="User" class="profile-img me-2">
                                            <div>
                                                <span class="fw-bold">Alex Johnson</span>
                                                <p class="mb-1">Buddy looks so happy! What a lovely day!</p>
                                                <div class="text-muted small">Posted 2 hours ago</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Additional comments can go here -->
                                </div>
                                <!-- Add Comment Section -->
                                <div class="mt-3">
                                    <div class="d-flex align-items-center">
                                        <textarea class="form-control" rows="1" placeholder="Write a comment..."></textarea>
                                    </div>
                                    <button class="btn btn-primary btn-sm mt-2">Post Comment</button>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>     
        <div id="rightSide" class="col-md-3">
            <div id="rightSideContent">
            <!-- Profile Container -->
                <div class="card p-3 profile-container" id="profileContainer" style="border-radius: 15px; background-color: #85d2ff;">
                    <h5 class="petListH5 text-center">Profile Details</h5>
                    <div id="profileDetails" class="profile-details-container">
                        <!-- Profile Picture -->
                        <div class="text-center mt-2 mb-3">
                            <img src="" id="profile" alt="Profile Picture"
                                class="profile-img-modern shadow"
                                style="width: 110px; height: 110px;">
                        </div>
                        <!-- Profile Details -->
                        <div class="profile-details text-center mb-2">
                            <h2 id="fullName" class="fw-bold mb-1" style="font-size: 1.6rem;">fname + lname</h2>
                            <div class="mb-2">
                                <span class="text-muted small">Email:</span>
                                <div id="email" class="fw-semibold" style="font-size: 1.1rem;">email</div>
                            </div>
                            <div>
                                <span class="text-muted small">Contact No.</span>
                                <div id="contact" class="fw-semibold" style="font-size: 1.1rem;">user contact</div>
                            </div>
                            <div class="mt-3">
                                <button id="addFriendBtn" class="btn btn-success btn-sm w-100">
                                    <i class="fas fa-user-plus me-2"></i>Add Friend
                                </button>
                                <button id="messageBtn" class="btn btn-primary btn-sm w-100 mt-2" >
                                    <i class="fas fa-paper-plane me-2"></i>Message
                                </button>
                                <button id="reportBtn" class="btn btn-danger btn-sm w-100 mt-2">
                                    <i class="fas fa-flag me-2"></i>Report
                                </button>
                            </div>
                        </div>
                        <!-- Add Pet Button -->
                        <div class="text-center mb-3">
                            <button type="button" class="btn add-pet-btn px-4 py-2" data-bs-toggle="modal" data-bs-target="#addPetModal">
                                <i class="fa fa-paw me-2"></i>Add Pet
                            </button>
                            
                        </div>
                        <!-- Settings and Logout -->
                        <div class="d-flex justify-content-center gap-3 mt-3">
                            <a class="profile-action-btn settings-link" href="#">
                                <i class="fas fa-cog me-2"></i> Settings
                            </a>
                            <a class="profile-action-btn logout-link" id="logOutBtn" href="#">
                                <i class="fas fa-sign-out-alt me-2"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
                <style>
                    .profile-container {
                        border-radius: 18px !important;
                        background: linear-gradient(135deg, #85d2ff 70%, #fff 100%);
                        border: none;
                        margin: 0 auto;
                        box-shadow: 0 4px 24px rgba(0,0,0,0.08);
                        height: 80px; /* Collapsed height */
                        overflow: hidden; /* Hide content when collapsed */
                        transition: height 0.6s ease; /* Smooth transition for height */
                        border: none;
                    }

                    .profile-container:hover {
                        height: 70%; /* Expanded height on hover */
                    }

                    .profile-details-container {
                        padding: 10px;
                    }
                    .profile-img-modern {
                        border-radius: 50%;
                        border: 4px solid #fff;
                        object-fit: cover;
                        background: #e9ecef;
                        transition: box-shadow 0.2s;
                    }
                    .profile-img-modern:hover {
                        box-shadow: 0 0 0 4px #38b6ff33;
                    }
                    .add-pet-btn {
                        background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
                        color: #fff;
                        font-weight: 700;
                        border: none;
                        border-radius: 30px;
                        box-shadow: 0 4px 16px rgba(56,182,255,0.15);
                        transition: background 0.3s, box-shadow 0.3s, transform 0.2s;
                        letter-spacing: 1px;
                        font-size: 0.8rem;
                    }
                    .add-pet-btn i {
                        font-size: 0.9rem;
                    }
                    .add-pet-btn:hover, .add-pet-btn:focus {
                        background: linear-gradient(90deg, #1e90ff 0%, #38b6ff 100%);
                        color: #fff;
                        box-shadow: 0 6px 24px rgba(56,182,255,0.25);
                        transform: translateY(-2px) scale(1.04);
                    }
                    .settings-link, .logout-link {
                        transition: background 0.2s, color 0.2s;
                        cursor: pointer;
                    }
                    .settings-link:hover {
                        background: #e3f2fd;
                        color: #1976d2 !important;
                        box-shadow: 0 6px 24px rgba(56,182,255,0.25);
                        transform: translateY(-2px) scale(1.04);
                    }
                    .logout-link:hover {
                        background: #ffeaea;
                        color: #d32f2f !important;
                        box-shadow: 0 6px 24px rgba(56,182,255,0.25);
                        transform: translateY(-2px) scale(1.04);
                    } 
                    .profile-action-btn {
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        background: linear-gradient(90deg, #38b6ff 0%, #85d2ff 100%);
                        color: #fff !important;
                        font-weight: 700;
                        border: none;
                        border-radius: 30px;
                        box-shadow: 0 4px 16px rgba(56,182,255,0.15);
                        transition: background 0.3s, box-shadow 0.3s, transform 0.2s, color 0.2s;
                        letter-spacing: 1px;
                        font-size: 0.8rem;
                        padding: 0.5rem 1.5rem;
                        min-width: 120px;
                        text-decoration: none;
                        margin: 0 2px;
                        cursor: pointer;
                    }
                    .profile-action-btn i {
                        font-size: 1.2rem;
                    }
                    .profile-action-btn:hover, .profile-action-btn:focus {
                        background: linear-gradient(90deg, #1e90ff 0%, #38b6ff 100%);
                        color: #fff !important;
                        box-shadow: 0 6px 24px rgba(56,182,255,0.25);
                        transform: translateY(-2px) scale(1.04);
                        text-decoration: none;
                    }
                    .logout-link {
                        background: linear-gradient(90deg, #ff7675 0%, #ffb199 100%);
                    }
                    .logout-link:hover, .logout-link:focus {
                        background: linear-gradient(90deg, #d32f2f 0%, #ff7675 100%);
                        color: #fff !important;
                    }
                </style>
                
                <div class="pet-profile-container text-center mt-5 card p-3" id="petMateList">
                     <div class="petListH5 mb-2">
                            <h5 class="">Pets</h5>
                    </div>
                    <div class="petCollection">
                        <ul class="list-group" id="petList"></ul>
                    </div>
                </div>

                <div class="modal fade" id="petDetailsModal" tabindex="-1" aria-labelledby="petDetailsLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-scrollable">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="petDetailsLabel">Pet Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="petDetailsBody">
                            <!-- Pet details will be inserted here -->
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="addPetModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center position-relative">
                            <h5 class="modal-title text-center" id="commentModalLabel">Add a Pet</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="top: 20px; right: 15px; position: absolute;"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="pet_name" class="form-label">Pet Name</label>
                                <input type="text" class="form-control" id="pet_name">
                            </div>
                            <div class="mb-3">
                                <label for="pet_type" class="form-label">Pet Type</label>
                                <input type="text" class="form-control" id="pet_type">
                            </div>
                            <div class="mb-3">
                                <label for="pet_breed" class="form-label">Breed</label>
                                <input type="text" class="form-control" id="pet_breed">
                            </div>
                            <div class="mb-3">
                                <label for="pet_birthdate" class="form-label">Birthdate</label>
                                <input type="date" class="form-control" id="pet_birthdate">
                            </div>
                            <div class="mb-3">
                                <label for="pet_gender" class="form-label">Gender</label>
                                <select class="form-select" id="pet_gender">
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="pet_color" class="form-label">Color</label>
                                <input type="text" class="form-control" id="pet_color">
                            </div>
                            <div class="mb-3">
                                <label for="pet_eye_color" class="form-label">Eye Color</label>
                                <input type="text" class="form-control" id="pet_eye_color">
                            </div>
                            <div class="mb-3">
                                <label for="pet_allergies" class="form-label">Allergies</label>
                                <textarea class="form-control" id="pet_allergies" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="pet_medical_conditions" class="form-label">Medical Conditions</label>
                                <textarea class="form-control" id="pet_medical_conditions" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="pet_weight" class="form-label">Weight (kg)</label>
                                <input type="number" class="form-control" id="pet_weight" step="0.01">
                            </div>
                            <div class="mb-3">
                                <label for="pet_size" class="form-label">Size</label>
                                <input type="text" class="form-control" id="pet_size">
                            </div>
                            <div class="mb-3">
                                <label for="pet_img" class="form-label">Pet Profile Image</label>
                                <input type="file" class="form-control" id="pet_img" accept="image/*">
                            </div>
                            <div class="mb-3">
                                <label for="pet_vaccine_img" class="form-label">Vaccination Image</label>
                                <input type="file" class="form-control" id="pet_vaccine_img" accept="image/*">
                            </div>
                            
                        </div>
                        <div class="modal-footer justify-content-center">
                            <button type="button" class="btn btn-primary" id="savePetBtn">Save Pet</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    

    <div class="modal fade" id="mediaModal" tabindex="-1" aria-labelledby="mediaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="mediaModalLabel">Media Viewer</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="mediaModalBody" style="text-align:center;"></div>
        <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-outline-primary" id="mediaModalPrev">Prev</button>
            <button type="button" class="btn btn-outline-primary" id="mediaModalNext">Next</button>
        </div>
        </div>
    </div>
    </div>
    <div class="modal fade" id="reportUserModal" tabindex="-1" aria-labelledby="reportUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="reportUserModalLabel"><i class="fas fa-flag me-2"></i>Report User</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form id="reportUserForm">
            <div class="mb-3">
                <label for="reportReason" class="form-label">Reason for reporting:</label>
                <select class="form-select" id="reportReason" required>
                <option value="" disabled selected>Select a reason</option>
                <option value="Spam">Spam</option>
                <option value="Harassment">Harassment</option>
                <option value="Inappropriate Content">Inappropriate Content</option>
                <option value="Fake Account">Fake Account</option>
                <option value="Scam or Fraud">Scam or Fraud</option>
                <option value="Other">Other</option>
                </select>
            </div>
            <div class="mb-3" id="otherReasonDiv" style="display:none;">
                <label for="otherReason" class="form-label">Please specify:</label>
                <input type="text" class="form-control" id="otherReason" maxlength="255">
            </div>
            <button type="submit" class="btn btn-danger w-100 fw-bold">Submit Report</button>
            </form>
        </div>
        </div>
    </div>
    </div>
    

  
    <!-- AJAX link -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="jsFile/userSide/otherProfile.js"></script>
    <script>
    // JS for the loading page
    function showLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'flex';
        }

        function hideLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
        }

        window.addEventListener('load', hideLoadingScreen);

        window.addEventListener('beforeunload', showLoadingScreen);

        $(document).ready(function() {
            $('#personalizedButton').click(function() {
                $('#personalizedContainer').removeClass('hidden');
                $('#publicContainer').addClass('hidden');
                $(this).addClass('contentTypeButtonActive').removeClass('contentTypeButtonDeactive');
                $('#publicButton').addClass('contentTypeButtonDeactive').removeClass('contentTypeButtonActive');
            });

            $('#publicButton').click(function() {
                $('#publicContainer').removeClass('hidden');
                $('#personalizedContainer').addClass('hidden');
                $(this).addClass('contentTypeButtonActive').removeClass('contentTypeButtonDeactive');
                $('#personalizedButton').addClass('contentTypeButtonDeactive').removeClass('contentTypeButtonActive');
            });
        });

        $('#chatIcon').click(function(e) {
            e.stopPropagation();
            $('#chatDropdown').toggle();
            $('#bellDropdown').hide();
        });

        $('#bellIcon').click(function(e) {
            e.stopPropagation();
            $('#bellDropdown').toggle();
            $('#chatDropdown').hide();
        });

        $(document).click(function(event) {
            if (!$(event.target).closest('#chatIcon, #chatDropdown').length) {
                $('#chatDropdown').hide();
            }
            if (!$(event.target).closest('#bellIcon, #bellDropdown').length) {
                $('#bellDropdown').hide();
            }
        });

        // $(document).ajaxStart(function() {
        //     showLoadingScreen();
        // });

        // $(document).ajaxComplete(function() {
        //     hideLoadingScreen();
        // });

        // $('form').on('submit', function() {
        //     showLoadingScreen();
        // });

        // Apply the loading screen to links with the loading-link class
        document.querySelectorAll('a.loading-link').forEach(function(anchor) {
            anchor.addEventListener('click', function() {
                showLoadingScreen();
            });
        });

        document.querySelectorAll('.chat-message').forEach(message => {
            message.addEventListener('click', function () {
                const userName = this.getAttribute('data-user');
                const userMessage = this.getAttribute('data-text');
        
                // Update modal content
                document.getElementById('userName').textContent = userName;
                document.getElementById('conversationContent').innerHTML = `
                    <div class="d-flex align-items-start mb-3">
                        <img src="media/images/default-profile.png" class="rounded-circle me-2" width="40" height="40" alt="${userName}">
                        <div class="bg-light p-2 rounded">
                            <strong>${userName}:</strong> ${userMessage}
                        </div>
                    </div>
                    <div class="d-flex align-items-start justify-content-end mb-3">
                        <div class="bg-primary text-white p-2 rounded">
                            <strong>You:</strong> Sure! Let me check.
                        </div>
                    </div>
                `;
        
                // Show modal
                const conversationModal = new bootstrap.Modal(document.getElementById('conversationModal'));
                conversationModal.show();
            });
        });
        
        function filterCategories() {
            const searchInput = document.getElementById("categorySearch").value.toLowerCase();
            const items = document.querySelectorAll(".category-item");
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchInput)) {
                    item.style.display = "block";
                } else {
                    item.style.display = "none";
                }
            });
        }

        document.querySelectorAll('.chat-item').forEach(item => {
            item.addEventListener('click', function () {
                const customerName = this.getAttribute('data-customer');
                const lastMessage = this.getAttribute('data-message');

                // Set modal title and load chat content
                document.getElementById('customerName').textContent = customerName;
                document.getElementById('chatContent').innerHTML = `
                    <div class="d-flex align-items-start mb-3">
                        <img src="media/images/default-profile.png" class="rounded-circle me-2" width="40" height="40" alt="${customerName}">
                        <div class="bg-light p-2 rounded">
                            <strong>${customerName}:</strong> ${lastMessage}
                        </div>
                    </div>
                    <div class="d-flex align-items-start justify-content-end mb-3">
                        <div class="bg-primary text-white p-2 rounded">
                            <strong>You:</strong> Sure! Let me check.
                        </div>
                    </div>
                `;

                // Initialize modals
                const viewChatModalElement = document.getElementById('viewChat');
                const chatModalElement = document.getElementById('chatModal');

                const viewChatModal = bootstrap.Modal.getInstance(viewChatModalElement) || new bootstrap.Modal(viewChatModalElement);
                const chatModal = bootstrap.Modal.getInstance(chatModalElement) || new bootstrap.Modal(chatModalElement);

                // Hide the viewChat modal and show the chatModal
                viewChatModal.hide();
                chatModal.show();
            });
        });

        $('#viewChatsButton').on('click', function () {
            const viewChatModalElement = document.getElementById('viewChat');
            const viewChatModal = bootstrap.Modal.getInstance(viewChatModalElement) || new bootstrap.Modal(viewChatModalElement);
            viewChatModal.show();
        });

    // JS for the Side Bar ------------------------------------------------------
    </script>

    <!-- SEARCH MODAL -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">Search Users</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="text" class="form-control mb-3" id="searchInput" placeholder="Search for users, pets, etc...">
        <div id="searchSuggestions" class="list-group mb-3" style="display:none;"></div>
        <h6 class="mb-2">Recent Searches</h6>
        <div class="row" id="recentSearches"></div>
      </div>
    </div>
  </div>
    // JS for the Side Bar ------------------------------------------------------
    </script>
</html>
    <!-- SEARCH MODAL -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">  <div class="modal-dialog modal-lg">    <div class="modal-content">      <div class="modal-header">        <h5 class="modal-title" id="searchModalLabel">Search Users</h5>        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>      </div>      <div class="modal-body">        <input type="text" class="form-control mb-3" id="searchInput" placeholder="Search for users, pets, etc...">        <div id="searchSuggestions" class="list-group mb-3" style="display:none;"></div>        <h6 class="mb-2">Recent Searches</h6>        <div class="row" id="recentSearches"></div>      </div>    </div>  </div></div><script>let currentChatUserId = null;let sessionUserId = null;let chatListInterval = null;
let conversationInterval = null;
let isConversationOpen = false;

// Get session user ID and load chats
$.getJSON('phpFile/globalSide/getSessionInfo.php', function(response) {
    if (response.status === "success" && response.data.user_id) {
        sessionUserId = response.data.user_id;
        loadChats();
        startChatListPolling();
    } else {
        alert("Not logged in or session error.");
    }
});

function loadChats() {
    $.get('phpFile/globalSide/getChats.php', function(data) {
        let users = data;
        if (typeof data === "string") {
            try { users = JSON.parse(data); } catch (e) { users = []; }
        }
        let html = `
            <div class="px-3 pt-3 pb-2">
                <h5 class="fw-bold mb-0" style="color:#1976d2;">Chats</h5>
            </div>
            <hr class="my-0">
        `;
        let hasUnread = false;
        let unreadTotal = 0;
        users.forEach((user) => {
            // Use fallback for profile image
            const img = user.profile_img
            ? "media/images/profiles/" + user.profile_img
            : "media/images/default-profile.png";
            // Use fallback for name
            const name =
            user.user_fname && user.user_lname
                ? user.user_fname + " " + user.user_lname
                : user.name || "Unknown";
            html += `
                <div class="chat-message" data-user-id="${
                user.id
                }" data-user-name="${name}">
                    <img class="profile-img" src="${img}" alt="Profile Picture">
                    <div class="message-details">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="name">${name}</span>
                            <span class="time">${user.sent_at || ""}</span>
                        </div>
                        <span class="message">${user.last_message || ""}</span>
                    </div>
                </div>
            `;
            if (user.unread_count && user.unread_count > 0) {
            hasUnread = true;
            unreadTotal += user.unread_count;
            }
        });
        $('#chatDropdown').html(html);

        // Show or hide the badge
        if (hasUnread) {
            $('#chatBadge').text(unreadTotal).show();
        } else {
            $('#chatBadge').hide();
        }

        // Add click event to open chat modal
        $('.chat-message').click(function() {
            currentChatUserId = $(this).data('user-id');
            $('#userName').text($(this).data('user-name'));
            loadMessages(currentChatUserId);

            // Mark messages as read for this conversation
            $.post('phpFile/globalSide/markMessageRead.php', { other_user_id: currentChatUserId }, function(res) {
                loadChats(); // Refresh badge after marking as read
            });

            // Stop chat list polling when modal is open
            if (chatListInterval) clearInterval(chatListInterval);

            // Start conversation polling
            if (conversationInterval) clearInterval(conversationInterval);
            conversationInterval = setInterval(function() {
                loadMessages(currentChatUserId);
            }, 2000);

            isConversationOpen = true;
            const conversationModal = new bootstrap.Modal(document.getElementById('conversationModal'));
            conversationModal.show();
        });
    }).fail(function(jqXHR, textStatus, errorThrown) {
        $('#chatDropdown').html('<div class="text-danger text-center py-4">Failed to load chats.</div>');
    });
}

// Start polling chat list every 5 seconds (when modal is closed)
function startChatListPolling() {
    if (chatListInterval) clearInterval(chatListInterval);
    chatListInterval = setInterval(function() {
        if (!isConversationOpen) loadChats();
    }, 5000);
}

// Stop conversation polling and resume chat list polling when modal closes
$('#conversationModal').on('hidden.bs.modal', function () {
    if (conversationInterval) clearInterval(conversationInterval);
    isConversationOpen = false;
    startChatListPolling();
});

// Load messages for a given user
function loadMessages(userId) {
    $.get('phpFile/globalSide/getConversation.php', { user_id: userId }, function(data) {
        let messages = data;
        if (typeof data === "string") {
            try { messages = JSON.parse(data); } catch (e) { messages = []; }
        }
        let html = '';
        messages.forEach(msg => {
            const isMe = msg.sender_id == sessionUserId;
            html += `
                <div class="d-flex ${isMe ? 'justify-content-end' : 'justify-content-start'} mb-2">
                    <div class="${isMe ? 'bg-primary text-white' : 'bg-light'} p-2 rounded shadow-sm" style="max-width:70%;">
                        <strong>${isMe ? 'You' : msg.user_fname + ' ' + msg.user_lname}:</strong>
                        ${msg.message}
                        <div class="small text-muted text-end">${msg.sent_at}</div>
                    </div>
                </div>
            `;
        });
        const $conversation = $('#conversationContent');
        $conversation.html(html || '<div class="text-center text-muted">No messages yet.</div>');
        // Scroll to bottom after loading
        $conversation.scrollTop($conversation[0].scrollHeight);
    });
}

// Send message on button click
$('#sendButton').click(function() {
    const message = $('#messageInput').val().trim();
    if (!message || !currentChatUserId) return;
    $.post('phpFile/globalSide/sendMessage.php', {
        receiver_id: currentChatUserId,
        message: message
    }, function(response) {
        $('#messageInput').val('');
        loadMessages(currentChatUserId); // Refresh conversation
        loadChats(); // Optional: refresh sidebar/chat list
    }, 'json');
});

// Optional: Send on Enter key
$('#messageInput').keypress(function(e) {
    if (e.which === 13) {
        $('#sendButton').click();
        return false;
    }
});

// Chat icon toggle
$('#chatIcon').click(function() {
    $('#chatDropdown').toggle();
    $('#chatDropdown').toggle();
});

// Close the dropdown if clicked outside// Close the dropdown if clicked outside
$(document).click(function(event) {
    if (!$(event.target).closest('#chatIcon, #chatDropdown').length) {
        $('#chatDropdown').hide();
    }
});


$('#messageBtn').click(function() {
    const otherUserId = $('#profileContainer').data('user-id');
    const otherUserName = $('#fullName').text();

    if (!otherUserId) {
        alert('User ID not found.');
        return;
    }

    currentChatUserId = otherUserId;
    $('#userName').text(otherUserName);

    const conversationModal = new bootstrap.Modal(document.getElementById('conversationModal'));
    conversationModal.show();

    // Load messages and scroll to bottom after loading
    loadMessages(currentChatUserId, function() {
        const $conversation = $('#conversationContent');
        $conversation.scrollTop($conversation[0].scrollHeight);
    });

    $.post('phpFile/globalSide/markMessageRead.php', { other_user_id: currentChatUserId }, function(res) {
        loadChats();
    });
});

// Modify loadMessages to accept a callback
function loadMessages(userId, callback) {
    $.get('phpFile/globalSide/getConversation.php', { user_id: userId }, function(data) {
        let messages = data;
        if (typeof data === "string") {
            try { messages = JSON.parse(data); } catch (e) { messages = []; }
        }
        let html = '';
        messages.forEach(msg => {
            const isMe = msg.sender_id == sessionUserId;
            html += `
                <div class="d-flex ${isMe ? 'justify-content-end' : 'justify-content-start'} mb-2">
                    <div class="${isMe ? 'bg-primary text-white' : 'bg-light'} p-2 rounded shadow-sm" style="max-width:70%;">
                        <strong>${isMe ? 'You' : msg.user_fname + ' ' + msg.user_lname}:</strong>
                        ${msg.message}
                        <div class="small text-muted text-end">${msg.sent_at}</div>
                    </div>
                </div>
            `;
        });
        const $conversation = $('#conversationContent');
        $conversation.html(html || '<div class="text-center text-muted">No messages yet.</div>');
        // Scroll to bottom after loading
        $conversation.scrollTop($conversation[0].scrollHeight);
        if (typeof callback === "function") callback();
    });
}

// Also scroll to bottom when modal is shown (for extra safety)
$('#conversationModal').on('shown.bs.modal', function () {
    const $conversation = $('#conversationContent');
    $conversation.scrollTop($conversation[0].scrollHeight);
});

// Get email from URL
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}
const email = getQueryParam('email');

if (email) {
    $.get('phpFile/globalSide/getUserIdByEmail.php', { email: email }, function(response) {
        if (typeof response === "string") response = JSON.parse(response);
        if (response.status === "success") {
            // Set the user ID as a data attribute for later use
            $('#profileContainer').attr('data-user-id', response.user_id);
        } else {
            alert('User not found');
        }
    });
}
$('#reportBtn').click(function() {
    $('#reportUserModal').modal('show');
});
$('#reportReason').on('change', function() {
    if ($(this).val() === 'Other') {
        $('#otherReasonDiv').show();
        $('#otherReason').prop('required', true);
    } else {
        $('#otherReasonDiv').hide();
        $('#otherReason').prop('required', false);
    }
});

$('#reportUserForm').submit(function(e) {
    e.preventDefault();
    const reportedUserId = $('#profileContainer').data('user-id');
    const reason = $('#reportReason').val() === 'Other' ? $('#otherReason').val() : $('#reportReason').val();

    if (!reportedUserId || !reason) {
        alert('Please select a reason.');
        return;
    }

    $.post('phpFile/globalSide/reportUser.php', {
        reported_user_id: reportedUserId,
        reason: reason
    }, function(response) {
        if (typeof response === "string") response = JSON.parse(response);
        if (response.status === "success") {
            $('#reportUserModal').modal('hide');
            alert('Report submitted. Thank you!');
        } else {
            alert('Failed to submit report.');
        }
    });
});
</script>
</body>
</html>

